# Помесячный прирост продаж с разбивкой по группе

## Дано
Дана следующая структура таблиц:

![структура таблиц](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database1.png "Схема БД")

## Задание
Нарастающим итогом рассчитать, как увеличивалось количество проданных тестов каждый месяц каждого года с разбивкой по группе.

## Столбцы в результате
- ```year``` - год
- ```month``` - месяц
- ```group``` - группа
- ```sum``` - количество проданных тестов

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Сортировка
Результат отсортируйте по возрастанию полей ```group```, ```year```, ```month```.

## Решение
``` SQL
WITH sales AS (
  SELECT 
    TO_CHAR(o.ord_datetime, 'YYYY') AS year, 
    TO_CHAR(o.ord_datetime, 'MM') AS month, 
    a.an_group AS group, 
    COUNT(*)::SMALLINT cnt
  FROM 
    orders o 
    JOIN analysis a ON o.ord_an = a.an_id 
  GROUP BY year, month, an_group
) 
SELECT
  year,
  month,
  s.group,
  SUM(s.cnt) OVER(PARTITION BY year, s.group ORDER BY year, month)
FROM 
  sales s
ORDER BY s.group, year, month
```