# [Тестовое Альфа-банк] Покупки телефонов в Туле по месяцам

```Эта задача взята из тестового задания на позицию Аналитика в Альфа-банк```

## Дано
Дана следующая структура таблиц:

![структура таблиц](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database17.png)

**Примечание.** Предполагается, что в таблице представлены данные только за 1 год.

**Примечание.** Значения в таблице представлены на латинице.

## Задание
Необходимо вывести количество людей из Тулы, которые покупали телефоны с разбивкой по месяцам.

**Примечание.** Телефоны - это товары с категорией 2 из таблицы ```skus```.

**Примечание.** Если один человек купил несколько раз за месяц, считаем это за одну покупку.

## Столбцы в результате
- ```month```
- ```people```

**Важно:** Месяца должны быть представлены не в виде цифр, а в виде английских слов с нижнем регистром.

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Сортировка
Результат должен быть отсортирован по убыванию значений в столбце ```people```.

## Дополнительные условия
Если вы используете функцию ```to_char(..., 'month')```, то обратите внимание, что PostgreSQL дополняет название месяца пробелами до 9 символов.

**Примечание.** Используемая СУБД - PostgreSQL.

## Решение
``` SQL
SELECT 
  TRIM(TO_CHAR(created_at, 'month')) AS month, 
  COUNT(DISTINCT user_id) AS people 
FROM 
  Purchases p 
  JOIN SKUS s ON p.sku_id = s.id 
  JOIN Customer c ON c.id_customer = p.user_id 
WHERE 
  category = 2 
  AND town = 'Tula' 
GROUP BY 
  1 
ORDER BY 
  people DESC
```