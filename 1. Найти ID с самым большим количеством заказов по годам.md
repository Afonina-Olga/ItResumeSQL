# Найти ID с самым большим количеством заказов по годам

## **Дано**
Дана следующая структура таблиц:

![Изображение](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database1.png "Схема БД")

## **Задание**
Выберите ID товара с самым большим количеством заказов с разбивкой по годам.

## **Столбцы в результате**

- year - год
- an_id - ID анализа
- cnt - количество заказов
*Примечание.** Год должен быть представлен в виде извлеченной из даты строки.

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## **Сортировка**
Результат отсортируйте по возрастанию столбцов year, an_id.

## **Решение**
``` SQL
WITH cte1 AS
  (SELECT EXTRACT(YEAR
                  FROM ord_datetime)::TEXT AS YEAR,
          ord_an AS an_id,
          COUNT(ord_an) AS cnt
   FROM Orders
   GROUP BY EXTRACT(YEAR
                    FROM ord_datetime),
            ord_an),
     cte2 AS
  (SELECT YEAR,
          an_id,
          cnt,
          RANK() OVER(PARTITION BY YEAR
                      ORDER BY cnt DESC) AS rank
   FROM cte1)
SELECT YEAR,
       an_id,
       cnt
FROM cte2
WHERE rank = 1
```
