# Фиксация входа-выхода сотрудников

## Дано
Дана таблица ```gate```:

```
+------------+---------------+--------------+
|  employee  |   check_time  |  is_entered  |
+------------+---------------+--------------+
```

Известно, что за каждым входом следует выход. В начале дня всегда вход, последний - всегда выход.

## Задание
Необходимо вывести сотрудников и дни, когда они находились на рабочем месте менее 8 часов.

## Столбцы в результате
- ```employee``` - имя сотрудника
- ```check_date``` - дата фиксации прохода
- ```sum``` - количество фактически отработанных часов

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Сортировка
Дополнительных условий по сортировке нет. Строки выводятся по мере расположения в исходной таблице.

## Решение
``` SQL
WITH a AS
(
SELECT employee,
       check_time::DATE AS check_date,
       COALESCE(
           CASE
                WHEN is_entered = False
                THEN check_time - LAG(check_time) OVER (
                    PARTITION BY employee, check_time::DATE
                    ORDER BY check_time)
                END,
           INTERVAL '0'
        ) AS diff
FROM gate
)
SELECT employee, check_date, TO_CHAR((sum(diff) || ' second')::interval, 'HH24:MI:SS') AS sum
FROM a
GROUP BY employee, check_date
HAVING SUM(diff) < INTERVAL '8 hours'
```