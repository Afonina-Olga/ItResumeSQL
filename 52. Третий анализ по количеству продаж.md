# Третий анализ по количеству продаж

## Дано
Дана следующая структура таблиц:

![структура таблиц](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database1.png)

## Задание
Вывести третий анализ по количеству продаж за весь период.

## Столбцы в результате
- ```an_id``` - ID анализа
- ```an_name``` - название анализа
- ```cnt``` - количество продаж
- ```rn``` - ранг анализа в зависимости от продаж

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Решение
``` SQL
WITH sales AS (
  SELECT 
    ord_an AS an_id, 
    COUNT(*) AS cnt 
  FROM 
    orders o 
  GROUP BY 
    ord_an
), 
rank AS (
  SELECT 
    an_id, 
    an_name, 
    cnt, 
    ROW_NUMBER() OVER(
      ORDER BY 
        cnt DESC
    ) AS rn 
  FROM 
    sales 
    JOIN analysis USING(an_id)
) 
SELECT 
  * 
FROM 
  rank 
WHERE 
  rn = 3
```