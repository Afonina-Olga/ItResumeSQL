# Средняя наценка по годам

## Дано
Дана следующая структура таблиц:

![структура таблиц](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database12.png)

## Задание
Вывести из таблицы ```Заказов``` информацию по средней наценке с разбивкой по годам.

**Примечание.** Наценка рассчитывается по формуле ```Наценка = (Розница - Себестоимость)/Себестоимость```

## Столбцы в результате
- ```Year```
- ```Mean_markup``` - рассчитанная наценка

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Сортировка
Результат отсортируйте по возрастанию года.

## Решение

``` SQL
SELECT 
  EXTRACT(
    YEAR 
    FROM 
      ord_datetime
  ) AS Year, 
  AVG(
    (an_price - an_cost):: NUMERIC / an_cost
  ) AS Mean_markup 
FROM 
  Orders o 
  LEFT JOIN Analysis a ON o.ord_an = a.an_id 
GROUP BY 
  EXTRACT(
    YEAR 
    FROM 
      ord_datetime
  ) 
ORDER BY 
  Year
```