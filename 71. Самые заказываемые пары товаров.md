# Самые заказываемые пары товаров

## Дано
Дана следующая структура таблиц:

![Схема базы](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database20.png)

## Задание
Проанализируйте поведение покупателей и определите, какие продукты часто покупаются вместе.

Напишите запрос, который возвращает пары товаров, которые чаще всего приобретались вместе, а также сколько раз эти товары были приобретены вместе.

Не включайте пары одного и того же продукта или пары, которые уже были перечислены (например, если вы перечисляете пару продуктов A и B, не перечисляйте также пару продуктов B и A).

**Пример результирующей таблицы:**

| id1 | id2 | count |
|-----|-----|-------|
| 17  | 63  | 4     |
| 38  | 40  | 3     |
| 49  | 72  | 3     |
| 2   | 88  | 2     |

## Столбцы в результате

- ```id1``` - id первого товара из пары
- ```id2``` - id второго товара
- ```count``` - количество раз, когда эту пару товаров заказывали в одном заказе

## Требования к сортировке
Результат отсортируйте по столбцу ```count``` в убывающем порядке, а затем по ```id1``` и ```id2``` в возрастающем.

## Решение
``` SQL
SELECT 
  id1, 
  id2, 
  Count(*) as count 
FROM 
  (
    SELECT 
      a.id_orders, 
      a.id_product as id1, 
      b.id_product as id2 
    FROM 
      order_details a 
      JOIN order_details b ON a.id_orders = b.id_orders 
      AND a.id_product < b.id_product 
    GROUP BY 
      a.id_orders, 
      a.id_product, 
      b.id_product
  ) x 
GROUP BY 
  id1, 
  id2 
ORDER BY 
  count DESC, 
  id1, 
  id2

```