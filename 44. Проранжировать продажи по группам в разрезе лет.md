# Проранжировать продажи по группам в разрезе лет

## Дано
Дана следующая структура таблиц:

![структура таблиц](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database43.png)

## Задание
Для каждого года в отдельности проранжировать продажи по группам анализов. Если для каких-то групп в рамках одного года продажи сопадают, то им присваивать одинаковое место. Ранги должны идти без разрывов.

## Столбцы в результате
- ```id``` - ID группы
- ```yea``` - год
- ```cnt``` - количество продаж
- ```rnk``` - ранг

**Важно:** Обратите внимание, что название столбцов в вашем ответе должно в точности совпадать с условием.

## Сортировка
Результат отсортируйте по возрастанию столбцов ```year```, ```rnk```, ```id```.

## Решение
``` SQL
WITH sales AS (
  SELECT 
    an_group AS id, 
    TO_CHAR(ord_datetime, 'YYYY') AS year, 
    COUNT(o.ord_id) AS cnt 
  FROM 
    Orders o 
    JOIN Analysis a ON o.ord_an = a.an_id 
  GROUP BY 
    id, 
    year
)
SELECT *, DENSE_RANK() OVER(PARTITION BY year ORDER BY cnt DESC) AS rnk
FROM sales
ORDER BY 
  year, 
  rnk, 
  id
```