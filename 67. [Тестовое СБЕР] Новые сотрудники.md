# [Тестовое СБЕР] Новые сотрудники

## Пролог
Вы работаете с базой данных, состоящей из таблицы ```employee2```.
Вы можете создать такую базу данных на своем компьютере для отладки запросов.

## Данные
**Таблица ```employee2```**:

- ```id``` (тип данных: ```SERIAL```) - уникальный идентификатор сотрудника (автоматически увеличиваемый).
- ```name``` (тип данных: ```VARCHAR(255)```) - имя сотрудника.
- ```department_id``` (тип данных: ```INT```) - идентификатор отдела, к которому принадлежит сотрудник.
- ```salary``` (тип данных: ```DECIMAL(10, 2)```) - заработная плата сотрудника, представленная в виде десятичного числа с двумя знаками после запятой.
- ```chief_id``` (тип данных: ```INT```) - это атрибут содержащий идентификатор сотрудника, который является руководителем, ```foreign key``` на таблицу ```employee2```.
- ```fk_chief``` внешний ключ связывает поле ```chief_id``` с полем ```id``` той же таблицы ```employee2```.

```
Pk – primary key, уникальный идентификатор таблицы    
Fk – foreign key, вторичный ключ для связывания с другой таблицей по pk
```     

## Задача
Напишите запрос, который выведет новых сотрудников, при добавлении которых средняя зарплата в каждом отделе стала бы одинаковая, причем зарплата новых сотрудников должна быть положительной.

Можно добавлять не более чем по 1 сотруднику в отдел.

**Важно:** поле ```CHIEF_ID``` для новых сотрудников оставить пустым.

## Решение

Алгоритм расчета простой:

1. сумма всех зарплат / кол-во сотрудников = средняя зарплата
2. (сумма всех зарплат + новая зарплата) / (кол-во сотрудников + 1 новый сотрудник) = ожидаемая средняя зарплата
3. ожидаемая средняя зарплата = текущая максимальная средняя зарплата
4. новая зарплата = ожидаемая зарплата * (кол-во сотрудников + 1) - сумма всех зарплат

``` SQL
select
  department_id, 
  NULL as name, 
  max(avg(salary)) over() * (count(*) + 1) - sum(salary) as salary, 
  NULL as chief_id
from 
  employee2 
group by 
  department_id
```