# Рекламная кампания

## Дано
Дана следующая структура таблиц:

![Схема базы](https://github.com/Afonina-Olga/ItResumeSQL/blob/main/img/database20.png)

## Пролог
Мы хотим запустить новую рекламную кампанию и предложить скидку на все товары нашим самым активным клиентам. Их активность мы оценим количеством покупок за месяц, чем больше совершено покупок - тем более активен клиент. Помогите нам проанализировать данные о продажах и определить пять лучших клиентов за декабрь 2021 года, которым мы дадим скидку.

## Задание
Напишите запрос, который выведет 5 лучших клиентов, имеющих право на скидку. Клиент подходит, если он совершил по крайней мере 2 покупки за декабрь 2021 года, и общая сумма, потраченная на эти покупки, превышает или равна 1500.

**Примечание:** Датой покупки, в данном случае, считаем ```date_order```.

## Столбцы в результате
- ```id_customer```
- ```total_spent_last_30_days``` - общая сумма заказов за период

## Решение
``` SQL
SELECT 
  id_customer, 
  SUM(price) AS total_spent_last_30_days 
FROM 
  c_orders 
WHERE 
  date_order BETWEEN '2021-12-01' 
  AND '2021-12-31' 
GROUP BY 
  id_customer 
HAVING 
  COUNT(*) > 1 
  AND SUM(price) >= 1500 
ORDER BY 
  SUM(price) DESC 
LIMIT 5
```